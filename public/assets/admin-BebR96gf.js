import{t as w,s as i}from"./ui-BebV0JXd.js";const c=".",y="itc-admin-auth",k=document.getElementById("admin-login-view"),E=document.getElementById("admin-dashboard-view"),u=document.getElementById("admin-login-form"),p=document.getElementById("tickets-tbody"),m=document.getElementById("users-tbody"),h=document.getElementById("logoutButton");function d(){const e=localStorage.getItem(y);return e?JSON.parse(e):null}function B(e){localStorage.setItem(y,JSON.stringify(e))}function g(){localStorage.removeItem(y),window.location.reload()}async function v(e,o){const n=await(await fetch(`${c}/api/auth/admin/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:o})})).json();return n.ok&&B({token:n.token,username:n.username,role:n.role}),n}async function b(){var o;const e=d();if(!e||!e.token)return[];try{const t=await fetch(`${c}/api/tickets`,{headers:{Authorization:`Bearer ${e.token}`}});if(!t.ok)throw new Error("Failed to fetch tickets");return await t.json()}catch(t){return console.error(t),i("Failed to load tickets.","error"),((o=t.response)==null?void 0:o.status)===403&&g(),[]}}async function L(e,o){const t=d();if(!(!t||!t.token))try{if(!(await fetch(`${c}/api/tickets/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.token}`},body:JSON.stringify({status:o})})).ok)throw new Error("Failed to update status");i("Status updated!","success")}catch(n){console.error(n),i("Failed to update status.","error"),b().then(C)}}async function A(){var o;const e=d();if(!e||!e.token)return[];try{const t=await fetch(`${c}/api/admin/users`,{headers:{Authorization:`Bearer ${e.token}`}});if(!t.ok)throw new Error("Failed to fetch users");return await t.json()}catch(t){return console.error(t),i("Failed to load users.","error"),((o=t.response)==null?void 0:o.status)===403&&g(),[]}}async function $(e,o){const t=d();if(!(!t||!t.token))try{if(!(await fetch(`${c}/api/admin/users/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.token}`},body:JSON.stringify({status:o})})).ok)throw new Error("Failed to update user");i(`User ${e} has been ${o}.`,"success"),A().then(T)}catch(n){console.error(n),i("Failed to update user.","error")}}function C(e=[]){var t;if(!p)return;if(p.innerHTML="",e.length===0){p.innerHTML='<tr><td colspan="7">No tickets found.</td></tr>';return}const o=["Open","In Progress","Resolved","Closed"];for(const n of e){const s=document.createElement("tr"),r=document.createElement("select");o.forEach(f=>{const l=document.createElement("option");l.value=f,l.textContent=f,f===n.status&&(l.selected=!0),r.appendChild(l)}),r.onchange=()=>L(n.id,r.value),s.innerHTML=`
      <td>${n.id}</td>
      <td>${n.empId||"N/A"}</td>
      <td>${n.category}</td>
      <td>${n.desc}</td>
      <td>${((t=n.createdBy)==null?void 0:t.username)||"N/A"}</td>
      <td>${new Date(n.createdAt).toLocaleString()}</td>
    `;const a=document.createElement("td");a.appendChild(r),s.appendChild(a),p.appendChild(s)}}function T(e=[]){if(!m)return;m.innerHTML="";const o=e.filter(t=>t.status==="pending");if(o.length===0){m.innerHTML='<tr><td colspan="5">No pending registrations.</td></tr>';return}for(const t of o){const n=document.createElement("tr"),s=document.createElement("button");s.className="approve-btn",s.textContent="Approve",s.onclick=()=>$(t.username,"approved");const r=document.createElement("button");r.className="reject-btn",r.textContent="Reject",r.onclick=()=>$(t.username,"rejected"),n.innerHTML=`
      <td>${t.username}</td>
      <td>${t.role}</td>
      <td>${new Date(t.registeredAt).toLocaleString()}</td>
      <td><span style="color: orange; font-weight: bold;">${t.status}</span></td>
    `;const a=document.createElement("td");a.className="actions",a.appendChild(s),a.appendChild(r),n.appendChild(a),m.appendChild(n)}}function S(){d()?(k.style.display="none",E.style.display="block",h.style.display="inline-block",b().then(C),A().then(T)):(k.style.display="block",E.style.display="none",h.style.display="none")}u&&u.addEventListener("submit",async e=>{e.preventDefault();const o=u.querySelector('button[type="submit"]');w(o,!0);try{const t=Object.fromEntries(new FormData(u).entries()),n=await v(t.username,t.password);n.ok?window.location.reload():i(`Login Failed: ${n.error}`,"error")}finally{w(o,!1)}});h&&h.addEventListener("click",g);document.addEventListener("DOMContentLoaded",S);
