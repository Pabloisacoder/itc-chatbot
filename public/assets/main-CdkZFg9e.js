import{t as m,s as d}from"./ui-BebV0JXd.js";const H=".",_="itc-auth";function N(e){localStorage.setItem(_,JSON.stringify(e))}function T(){const e=localStorage.getItem(_);return e?JSON.parse(e):null}function x(){localStorage.removeItem(_),window.location.reload()}async function j(e,t){const o=await(await fetch(`${H}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})})).json();return o.ok&&N({token:o.token,username:o.username,role:o.role}),o}async function M(e,t,n,o){return await(await fetch(`${H}/api/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t,role:n,contractor:o})})).json()}function w(){return new Promise(e=>{if(T())return e(!0);const t=document.getElementById("loginDialog");if(!t)return console.error("Login dialog not found!"),d("Login dialog not found!","error"),e(!1);window.onAuthSuccess=()=>{t.close(),e(!0)},t.showModal(),t.onclose=()=>{T()||e(!1)}})}function q(){const e=document.getElementById("loginDialog"),t=document.getElementById("loginForm"),n=document.getElementById("registerForm"),o=document.getElementById("logoutButton"),a=document.getElementById("showLoginButton"),i=document.getElementById("showRegisterButton"),r=document.getElementById("adminDashboardButton"),s=document.getElementById("authStatus"),P=T();if(P?(s&&(s.innerHTML=`Hello <b>${P.username}</b>`,s.removeAttribute("data-translate-key")),a&&(a.style.display="none"),i&&(i.style.display="none"),o&&(o.style.display="inline-block"),r&&(r.style.display=P.role==="Admin"?"inline-block":"none")):(s&&(s.textContent="Not logged in"),a&&(a.style.display="inline-block"),i&&(i.style.display="inline-block"),o&&(o.style.display="none"),r&&(r.style.display="inline-block")),a&&(a.onclick=()=>{e.showModal(),t&&(t.style.display="block"),n&&(n.style.display="none")}),i&&(i.onclick=()=>{e.showModal(),t&&(t.style.display="none"),n&&(n.style.display="block")}),o&&(o.onclick=()=>x()),t&&(t.onsubmit=async b=>{b.preventDefault();const y=t.querySelector('button[type="submit"]');m(y,!0);try{const c=Object.fromEntries(new FormData(t).entries()),u=await j(c.username,c.password);u.ok?window.onAuthSuccess?(window.onAuthSuccess(),s&&(s.innerHTML=`Hello <b>${u.username}</b>`,s.removeAttribute("data-translate-key")),a&&(a.style.display="none"),i&&(i.style.display="none"),o&&(o.style.display="inline-block"),r&&(r.style.display=u.role==="Admin"?"inline-block":"none")):window.location.reload():d(`Login Failed: ${u.error}`,"error")}finally{m(y,!1)}}),n){const b=e.querySelector("#switchToRegister");b&&(b.onclick=c=>{c.preventDefault(),t.style.display="none",n.style.display="block"});const y=e.querySelector("#switchToLogin");y&&(y.onclick=c=>{c.preventDefault(),n.style.display="none",t.style.display="block"}),n.onsubmit=async c=>{c.preventDefault();const u=n.querySelector('button[type="submit"]');m(u,!0);const g=Object.fromEntries(new FormData(n).entries());if(g.password!==g.confirmPassword)return m(u,!1),d("Passwords do not match!","error");const B=await M(g.username,g.password,g.role,g.contractor);m(u,!1),B.ok?(d(B.message,"success"),e.close()):d(`Registration Failed: ${B.error}`,"error")}}}const U=".",L={en:{created:"Ticket created:",failed:"Failed:",networkError:"Network error",notFound:"Ticket dialog or form not found"},hi:{created:"टिकट बनाया गया:",failed:"विफल:",networkError:"नेटवर्क त्रुटि",notFound:"टिकट संवाद या फ़ॉर्म नहीं मिला"}};function k(e){var n;const t=localStorage.getItem("language")||"en";return((n=L[t])==null?void 0:n[e])||L.en[e]}function R(){const e=document.getElementById("ticketDialog"),t=document.getElementById("ticketForm");return!e||!t?(console.error(k("notFound")),{dialog:null,form:null}):{dialog:e,form:t}}async function C(){if(!await w())return;const{dialog:t}=R();t&&(t.open||t.showModal())}function K(){const{dialog:e,form:t}=R();!t||!e||t.addEventListener("submit",async n=>{n.preventDefault();const o=t.querySelector('button[type="submit"]');m(o,!0);const a=Object.fromEntries(new FormData(t).entries()),{token:i}=T();try{const s=await(await fetch(`${U}/api/tickets`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(a)})).json();s.ok?(d(`${k("created")} ${s.ticket.id}`,"success"),e.close(),t.reset()):d(`${k("failed")} `+(s.error||"Unknown error"),"error")}catch(r){console.error("Error submitting ticket:",r),d(k("networkError"),"error")}finally{m(o,!1)}})}const z=".";let p,I,f,v;const S={payslip:{greeting:"Sure—payslip help. What do you need?",options:[{label:"Where to find payslip",reply:"ESS > Payroll > Payslips. Pick a month and download PDF."},{label:"Payslip not visible",reply:"Try clearing cache or check after 15 mins. If still missing, raise a ticket."},{label:"Raise a ticket",reply:"__RAISE_TICKET__"}]},attendance:{greeting:"Attendance help. Choose one:",options:[{label:"Missed punch regularization",reply:"Attendance Portal > Regularize > select date & reason > submit."},{label:"Biometric not working",reply:"Try another device and ensure HR has mapped your employee ID."},{label:"Raise a ticket",reply:"__RAISE_TICKET__"}]}},D={en:{mainOptions:"You can ask me about 'Payslip' or 'Attendance'.",unknown:"I'm sorry, I don't understand that. Please choose from the available options."},hi:{mainOptions:"आप मुझसे 'Payslip' या 'Attendance' के बारे में पूछ सकते हैं।",unknown:"मुझे क्षमा करें, मैं यह समझ नहीं पा रहा हूँ। कृपया उपलब्ध विकल्पों में से चुनें।"}};function $(e){var n;const t=localStorage.getItem("language")||"en";return((n=D[t])==null?void 0:n[e])||D.en[e]}function l(e,t="bot"){const n=document.createElement("li");n.className=`chat-message ${t}`,n.textContent=e,I.appendChild(n),p.scrollTop=p.scrollHeight}function E(e,t){const n=document.createElement("ul");n.className="chat-options",e.forEach(o=>{const a=document.createElement("li"),i=document.createElement("button");i.textContent=o.label,i.onclick=()=>t(o),a.appendChild(i),n.appendChild(a)}),I.appendChild(n),p.scrollTop=p.scrollHeight}async function A(e){if(await w()){if(document.querySelectorAll(".chat-options").forEach(t=>t.remove()),l(e.label,"user"),e.reply==="__RAISE_TICKET__"){l("Okay, opening the ticket submission form for you."),await C(),setTimeout(h,500);return}l(e.reply),setTimeout(h,2e3)}}async function J(e){if(!await w())return;if(document.querySelectorAll(".chat-options").forEach(n=>n.remove()),l(e.label,"user"),e.reply==="__RAISE_TICKET__"){l("Okay, opening the ticket submission form for you."),await C(),setTimeout(h,500);return}const t=e.reply.replace("__INPUT_","");if(S[t]){const n=S[t];l(n.greeting),E(n.options,A)}}async function O(){const e=f.value.trim().toLowerCase();if(e&&await w())if(l(e,"user"),f.value="",e.includes("payslip")||e.includes("nómina")){const t=S.payslip;l(t.greeting),E(t.options,A)}else if(e.includes("attendance")||e.includes("asistencia")){const t=S.attendance;l(t.greeting),E(t.options,A)}else l($("unknown")),setTimeout(h,1500)}async function h(){document.querySelectorAll(".chat-options").forEach(t=>t.remove());const e=localStorage.getItem("language")||"en";try{const t=await fetch(`${z}/api/bot/intro?lang=${e}`),{lines:n}=await t.json();n.forEach(o=>l(o))}catch(t){console.error("Failed to fetch intro:",t),l("Hello! How can I help you today?")}l($("mainOptions")),E([{label:"Payslip Help",reply:"__INPUT_payslip"},{label:"Attendance Help",reply:"__INPUT_attendance"},{label:"Raise a Ticket",reply:"__RAISE_TICKET__"}],J)}function W(){if(p=document.getElementById("chat-window"),I=document.getElementById("message-list"),f=document.getElementById("message-input"),v=document.getElementById("send-button"),!p||!I||!f||!v){console.error("Chatbot UI elements not found!");return}v.onclick=O,f.onkeydown=e=>{e.key==="Enter"&&O()},h()}function G(){const e=document.getElementById("mic-button"),t=document.getElementById("lang-switcher"),n=window.SpeechRecognition||window.webkitSpeechRecognition;if(!n){e&&(e.style.display="none");return}if(!e)return;const o=()=>{e.classList.remove("listening"),e.innerHTML=`
      <svg viewBox="0 0 24 24" width="24" height="24">
        <path fill="currentColor" d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.66 9 5v6c0 1.66 1.34 3 3 3z"/>
        <path fill="currentColor" d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
      </svg>
    `},a=new n;a.continuous=!1,a.interimResults=!1,e.addEventListener("click",async()=>{if(await w())if(e.classList.contains("listening"))a.stop();else{const r=t?t.value:"en";a.lang=r==="hi"?"hi-IN":"en-US",a.start()}}),a.onstart=()=>{e.classList.add("listening"),e.innerHTML=`
      <div class="google-dots">
        <span></span><span></span><span></span><span></span>
      </div>
    `},a.onend=()=>{o()},a.onerror=()=>{o()},a.onresult=i=>{const r=i.results[0][0].transcript;C(),setTimeout(()=>{const s=document.querySelector('#ticketForm textarea[name="desc"]');s&&(s.value=r,s.focus())},100)}}const F={en:{mainTitle:"ITC Helpdesk",authStatusDefault:"Not logged in",adminDashboard:"Admin Dashboard",login:"Login",register:"Register",logout:"Logout",availabilityTitle:"24/7 Availability",availabilityText:"Our automated support is always online to assist you anytime, day or night.",instantSupportTitle:"Instant Support",instantSupportText:"Get immediate answers to your payroll and attendance queries.",messagePlaceholder:"Type your message...",send:"Send",trustableBrandTitle:"Trustable Brand",trustableBrandText:"We are committed to providing reliable and accurate assistance.",securePlatformTitle:"Secure Platform",securePlatformText:"Your employee data is handled with enterprise-grade security.",usernamePlaceholder:"Username",passwordPlaceholder:"Password",noAccount:"No account?",registerHere:"Register here",confirmPasswordPlaceholder:"Confirm Password",haveAccount:"Have an account?",loginHere:"Login here",createTicketTitle:"Create a New Ticket",empIdPlaceholder:"Employee ID",emailPlaceholder:"Email",selectCategoryOption:"--Select Category--",describeIssuePlaceholder:"Describe the issue",submitTicket:"Submit Ticket"},hi:{mainTitle:"आईटीसी हेल्पडेस्क",authStatusDefault:"लॉग इन नहीं हैं",adminDashboard:"एडमिन डैशबोर्ड",login:"लॉग इन करें",register:"पंजीकरण करें",logout:"लॉग आउट",availabilityTitle:"24/7 उपलब्धता",availabilityText:"हमारी स्वचालित सहायता आपकी सहायता के लिए किसी भी समय, दिन हो या रात, हमेशा ऑनलाइन रहती है।",instantSupportTitle:"तुरंत सहायता",instantSupportText:"अपने वेतन और उपस्थिति प्रश्नों के तुरंत उत्तर प्राप्त करें।",messagePlaceholder:"अपना संदेश टाइप करें...",send:"भेजें",trustableBrandTitle:"विश्वसनीय ब्रांड",trustableBrandText:"हम विश्वसनीय और सटीक सहायता प्रदान करने के लिए प्रतिबद्ध हैं।",securePlatformTitle:"सुरक्षित प्लेटफ़ॉर्म",securePlatformText:"आपके कर्मचारी डेटा को एंटरप्राइज़-ग्रेड सुरक्षा के साथ संभाला जाता है।",usernamePlaceholder:"उपयोगकर्ता नाम",passwordPlaceholder:"पासवर्ड",noAccount:"खाता नहीं है?",registerHere:"यहां पंजीकरण करें",confirmPasswordPlaceholder:"पासवर्ड की पुष्टि करें",haveAccount:"खाता है?",loginHere:"यहां लॉग इन करें",createTicketTitle:"एक नया टिकट बनाएं",empIdPlaceholder:"कर्मचारी आईडी",emailPlaceholder:"ईमेल",selectCategoryOption:"--श्रेणी चुनें--",describeIssuePlaceholder:"समस्या का वर्णन करें",submitTicket:"टिकट जमा करें"}};function Y(){const e=localStorage.getItem("language")||"en",t=F[e]||F.en;document.querySelectorAll("[data-translate-key]").forEach(n=>{const o=n.dataset.translateKey;t[o]&&(n.placeholder!==void 0?n.placeholder=t[o]:n.textContent=t[o])})}document.addEventListener("DOMContentLoaded",()=>{q(),W(),K();try{G()}catch(t){console.error("Audio setup failed",t)}Y();const e=document.getElementById("lang-switcher");e&&(e.value=localStorage.getItem("language")||"en",e.onchange=()=>{localStorage.setItem("language",e.value),window.location.reload()})});
